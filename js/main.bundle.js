(()=>{"use strict";const e={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало"},t=document.querySelector("#card").content.querySelector("article"),r=function(e){t.querySelector(e).classList.add("hidden")},o={bungalow:{PLACEHOLDER:"0",PRICE_MIN:0},flat:{PLACEHOLDER:"1000",PRICE_MIN:1e3},house:{PLACEHOLDER:"5000",PRICE_MIN:5e3},palace:{PLACEHOLDER:"10000",PRICE_MIN:1e4}},n=document.querySelector("#price"),a=document.querySelector("#type"),c=document.querySelector("#timein"),i=document.querySelector("#timeout"),u=document.querySelector("#title"),s=document.querySelector("#capacity"),l=document.querySelector("#room_number"),d=document.querySelector(".ad-form"),p=d.querySelectorAll("fieldset"),f=document.querySelector(".ad-form__reset");a.addEventListener("change",(()=>{n.placeholder=o[a.value].PLACEHOLDER,n.min=o[a.value].PRICE_MIN})),c.addEventListener("change",(function(){i.value=c.value})),i.addEventListener("change",(function(){c.value=i.value})),u.addEventListener("input",(e=>{const t=e.currentTarget.value.length;t<30?u.setCustomValidity("Минимальная длина - 30 симв.: осталось ещё "+(30-t)):t>100?u.setCustomValidity("Удалите лишние "+(t-100)+" симв."):u.setCustomValidity(""),u.reportValidity()})),n.addEventListener("change",(e=>{const t=e.currentTarget.value;t<o[a.value].PRICE_MIN?n.setCustomValidity("Минимальная цена ночь - "+o[a.value].PRICE_MIN+": увеличьте вводимую цену"):t>1e6?n.setCustomValidity("Максимальная цена ночь - 1000000: уменьшите вводимую цену"):n.setCustomValidity(""),n.reportValidity()}));const m=()=>{const e=Number(l.value),t=Number(s.value);1===e&&1!==t?s.setCustomValidity("1 комната - для 1 гостя"):2!==e||3!==t&&0!==t?3===e&&0===t?s.setCustomValidity("3 комнаты - для 1-3 гостей"):100===e&&0!==t?s.setCustomValidity("100 комнат - не для гостей"):s.setCustomValidity(""):s.setCustomValidity("2 комнаты - для 1-2 гостей"),s.reportValidity()};l.addEventListener("change",(()=>m())),s.addEventListener("change",(()=>m()));const y=e=>"Escape"===e.key,h=(e,t)=>{let r;return function(){clearTimeout(r),r=setTimeout((()=>e.apply(this,arguments)),t)}},v=document.querySelector("main"),_=document.querySelector("#success").content.querySelector(".success"),g=document.querySelector("#error").content.querySelector(".error"),S=()=>{_.remove(),document.removeEventListener("keydown",q),document.removeEventListener("click",S)},q=e=>{y(e)&&(e.preventDefault(),S())},E=()=>{g.remove(),document.removeEventListener("keydown",C),document.removeEventListener("click",E)},C=e=>{y(e)&&(e.preventDefault(),E())},b="any",w=/filter-/,k=document.querySelector(".map__filters"),x=k.querySelectorAll(".map__filter"),A=k.querySelector("#housing-type"),I=k.querySelector("#housing-price"),V=k.querySelector("#housing-rooms"),D=k.querySelector("#housing-guests"),P=document.querySelector("#filter-wifi"),R=document.querySelector("#filter-dishwasher"),N=document.querySelector("#filter-parking"),T=document.querySelector("#filter-washer"),M=document.querySelector("#filter-elevator"),H=document.querySelector("#filter-conditioner"),O=(e,t)=>t.value===b||"low"===t.value&&e.offer.price<1e4||"high"===t.value&&e.offer.price>=5e4||"middle"===t.value&&e.offer.price>=1e4&&e.offer.price<5e4,F=(e,t)=>t.value===b||Number(t.value)===e.offer.rooms,j=(e,t)=>t.value===b||parseInt(t.value,10)<=e.offer.guests,$=(e,t)=>{const r=e.getAttribute("id").replace(w,"");return!1===e.checked||t.offer.features.includes(r)},z=["gif","jpg","jpeg","png"],U="img/muffin-grey.svg",W=document.querySelector(".ad-form-header__input"),B=document.querySelector(".ad-form-header__preview"),G=document.querySelector(".ad-form-header__preview img"),J=document.querySelector(".ad-form__input"),K=document.querySelector(".ad-form__photo"),Q=document.querySelector(".ad-form__photo img"),X=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},Y=(e,t,r)=>{const o=e.cloneNode(!0);o.src=r,t.appendChild(o)},Z=(e,t,r,o)=>{if(z.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{Y(r,o,t.result)})),t.readAsDataURL(e)}};W.addEventListener("change",(()=>{((e,t,r)=>{X(r);const o=e.files[0],n=o.name.toLowerCase();Z(o,n,t,r)})(W,G,B)})),J.addEventListener("change",(()=>{((e,t,r)=>{X(r);for(let o=0;o<e.files.length;o++){const n=e.files[o].name.toLowerCase();Z(e.files[o],n,t,r)}})(J,Q,K)}));const ee=()=>{d.reset(),k.reset(),ye(),le(),he(fe),X(B),Y(G,B,U),X(K),Y(Q,K,U)},te=()=>{v.appendChild(_),document.addEventListener("keydown",q),document.addEventListener("click",S),ee(),ve()};d.addEventListener("submit",(e=>{var t,r;e.preventDefault(),t=new FormData(e.target),r=te,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((e=>{if(!e.ok)throw new Error(`${e.status} - ${e.statusText}`);r()})).catch((()=>{v.appendChild(g),document.addEventListener("keydown",C),document.addEventListener("click",E)}))}));const re=L.map("map-canvas"),oe=document.querySelector("#address");let ne=[];const ae=35.68949,ce=139.69171,ie=function(e,t){oe.value=e+","+t},ue=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),se=L.icon({iconUrl:"./img/pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),le=()=>{ie(ae,ce)},de=()=>{re.on("load",(()=>{d.classList.remove("ad-form--disabled"),p.forEach((e=>{e.removeAttribute("disabled")})),k.classList.remove("map__filters--disabled"),x.forEach((e=>{e.removeAttribute("disabled")})),le()})),re.setView({lat:ae,lng:ce},10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(re)},pe=L.marker({lat:ae,lng:ce},{draggable:!0,icon:ue});pe.addTo(re),pe.on("moveend",(e=>{ie(e.target.getLatLng().lat.toFixed(5),e.target.getLatLng().lng.toFixed(5))}));const fe=[],me=o=>{o.forEach((o=>{const n=L.marker({lat:o.location.lat,lng:o.location.lng},{draggable:!0,icon:se});n.addTo(re).bindPopup(function(o){const n=t.cloneNode(!0);o.offer.title?n.querySelector(".popup__title").textContent=o.offer.title:r(".popup__title"),o.offer.address?n.querySelector(".popup__text--address").textContent=o.offer.address:r(".popup__text--address"),o.offer.price?n.querySelector(".popup__text--price").textContent=o.offer.price+" ₽/ночь":r(".popup__text--price"),o.offer.type?n.querySelector(".popup__type").textContent=e[o.offer.type]:r(".popup__type");const a=o.offer.rooms,c=o.offer.guests;o.offer.rooms&&o.offer.guests?n.querySelector(".popup__text--capacity").textContent=a+(1===a?" комнатa для ":2===a||3===a||4===a?" комнаты для ":" комнат для ")+c+(1===c?" гостя":" гостей"):r(".popup__text--capacity"),o.offer.time?n.querySelector(".popup__text--time").textContent="Заезд после "+o.offer.checkin+" выезд до "+o.offer.checkout:r(".popup__text--time");const i=n.querySelector(".popup__features");i.innerHTML="",o.offer.features&&o.offer.features.length?i.appendChild(function(e){const t=document.createDocumentFragment();for(let r=0;r<e.length;r++){const o=document.createElement("li");o.classList.add("popup__feature--"+e[r],"popup__feature"),t.appendChild(o)}return t}(o.offer.features)):r(".popup__features");const u=n.querySelector(".popup__photos");return u.innerHTML="",o.offer.photos&&o.offer.photos.length?u.appendChild(function(e){const t=document.createDocumentFragment();for(let r=0;r<e.length;r++){const o=document.createElement("img");o.classList.add("popup__photo"),o.setAttribute("src",e[r]),o.setAttribute("width",45),o.setAttribute("height",40),o.setAttribute("alt","Фотография жилья"),t.appendChild(o)}return t}(o.offer.photos)):r(".popup__photos"),o.offer.description?n.querySelector(".popup__description").textContent=o.offer.description:r(".popup__description"),o.offer.avatar?n.querySelector(".popup__avatar").src=o.author.avatar:r(".popup__avatar"),n}(o),{keepInView:!0}),fe.push(n)}))},ye=()=>{pe.setLatLng([ae,ce])},he=()=>{for(let e=0;e<fe.length;e++)fe[e].remove()},ve=()=>{var e;e=e=>{ne=e.slice(0,10),de(),me(e),(e=>{k.addEventListener("change",(e=>h((t=>{t.preventDefault();const r=(e=>{const t=[];for(let n=0;n<e.length&&!(t.length>10);n++)r=e[n],((o=A).value===b||r.offer.type===o.value)&&O(e[n],I)&&F(e[n],V)&&j(e[n],D)&&$(P,e[n])&&$(R,e[n])&&$(N,e[n])&&$(T,e[n])&&$(M,e[n])&&$(H,e[n])&&t.push(e[n]);var r,o;return t})(e);he(),me(r)}),500))(e))})(ne),f.addEventListener("click",(e=>{e.preventDefault(),ee(),ve()}))},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} - ${e.statusText}`)})).then((t=>e(t))).catch((e=>{(e=>{const t=document.querySelector("#server-error").content.querySelector(".server-error").cloneNode(!0),r=document.createElement("p");r.classList.add("server-error__message"),r.textContent=e,t.appendChild(r),document.body.appendChild(t),setTimeout((()=>{t.remove()}),1e4)})(e+". Не удалось загрузить данные")}))};d.classList.add("ad-form--disabled"),p.forEach((e=>{e.setAttribute("disabled",!0)})),k.classList.add("map__filters--disabled"),x.forEach((e=>{e.setAttribute("disabled",!0)})),de(),ve()})();
//# sourceMappingURL=main.bundle.js.map